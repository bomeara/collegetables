---
title: College Tables
output:
  html_document:
    includes:
       in_header: GA_Script.html
---

## STILL A DRAFT; DO NOT USE

For deciding on which college to go to (as an undergraduate, graduate student, employee such as faculty member, or other) there are a lot of resources (especially for potential undergraduate students). For example, https://collegescorecard.ed.gov is created by the federal government and has great info on things like costs and expected income; there are various sites that use a secret sauce to rank colleges (what do guidance counselors think about them, how often is research from the college cited, etc.). However, as a parent, these all felt somewhat lacking: a focus on income after graduation seems sensible, for example, but a college that sends more of its students to high paying jobs on Wall Street isn't necessarily a better one than a college whose students make less money working on humanitarian issues. There are data that most sites ignore: are the libraries well-stocked and well-used; how much of a drinking culture does campus have; do faculty have academic freedom to do research and teach; how diverse are the faculty; how has the college valued safety during the covid pandemic? And issues of the environment a college is in matter: are there limits on the healthcare students can receive, is the state for or against LGBTQ+ rights, what's the weather like, is there mass transit available, and so forth. This site attempts to gather all this. It has one massive table below, but then you can go to a page on each college to get visualizations and more tables.

All the fields can be filtered on. For ones with a few options (Yes/No, States, Sector, Abortion, etc.) you can select from pre-computed selections; for numbers, you can filter by the upper and lower limits; for free text, you can search. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, eval=TRUE}
source("_packages.R")
source("R/functions.R")
tar_load(overview)
tar_load(maxcount)
tar_load(degree_granting_enhanced)
for (i in sequence(min(maxcount, nrow(overview)))) {
	overview$Name[i] <- paste0("<a href='https://collegetables.info/", overview$URL[i], "'>", overview$Name[i], "</a>")
}
overview$Locale <- overview$LocaleChar
Basic <- c("Name", "Sector", "Level of institution", "Undergraduate enrollment", "Grad enrollment")

Admissions_and_outcomes <- c("Admission", "Yield", "First year retention", "Graduation")

Location <- c("State", "Locale", "Warmest month max temp", "Coldest month min temp", "Annual precipitation", "biome")

Safety <- c("Anti-LGBTQ+ state laws", "Abortion", "Covid vax (employees)", "Covid vax (students)", "Gun law stringency","Proportion of reps voting in favor of respect for right to contraception act", "Proportion of reps voting in favor of respect for marriage act")

AcademicResources <- c("Undergrads per tenure-track professor", "Undergrads per instructor", "Average library loans (physical) per student or faculty member", "Number of physical books", "Number of digital/electronic books")

Misconduct <- c("Liquor discipline per student (3 yr avg)", "Drug discipline per student (3 yr avg)", "Weapon arrest per student (3 yr avg)", "Reported rape per student (3 yr avg)", "Reported fondling per student (3 yr avg)")

Undergrad_diversity <- colnames(overview)[grepl("undergrads", colnames(overview))]

Faculty_diversity <- colnames(overview)[grepl("Full-time faculty", colnames(overview))]

overview$State <- as.factor(overview$State)
overview$Sector <- as.factor(overview$Sector)
overview$`Level of institution` <- as.factor(overview$`Level of institution`)



GetMatchingColumnsInOverview <- function(to_find) {
	return(-1+match(to_find, colnames(overview)))	
}

GetNotMatchingColumnsInOverview <- function(to_find) {
	unmatched <- setdiff(colnames(overview), unique(c("Name", to_find)))
	return(-1+match(unmatched, colnames(overview)))	
}

DT::datatable(overview, rownames=FALSE, filter="top", escape=FALSE, extensions = c('Buttons', 'FixedColumns', 'FixedHeader'), options = list(
    dom = 'Bfrtip',
    buttons = list(
		list(
			extend= "colvisGroup", 
			text="Overview", 
			show=c(0, GetMatchingColumnsInOverview(Basic)),
			hide=GetNotMatchingColumnsInOverview(Basic)
		),
		list(
			extend= "colvisGroup",
			text="Admissions & Outcomes",
			show=c(0, GetMatchingColumnsInOverview(Admissions_and_outcomes)), 
			hide=GetNotMatchingColumnsInOverview(Admissions_and_outcomes)
		),
		list(
			extend= "colvisGroup",
			text="Location",
			show=c(0, GetMatchingColumnsInOverview(Location)), 
			hide=GetNotMatchingColumnsInOverview(Location)
		),
		list(
			extend= "colvisGroup",
			text="Academic resources",
			show=c(0, GetMatchingColumnsInOverview(AcademicResources)), 
			hide=GetNotMatchingColumnsInOverview(AcademicResources)
		),
		list(
			extend= "colvisGroup",
			text="Safety",
			show=c(0, GetMatchingColumnsInOverview(Safety)), 
			hide=GetNotMatchingColumnsInOverview(Safety)
		),
		list(
			extend= "colvisGroup",
			text="Misconduct",
			show=c(0, GetMatchingColumnsInOverview(Misconduct)), 
			hide=GetNotMatchingColumnsInOverview(Misconduct)
		),
		list(
			extend= "colvisGroup",
			text="Undergrad diversity",
			show=c(0, GetMatchingColumnsInOverview(Undergrad_diversity)), 
			hide=GetNotMatchingColumnsInOverview(Undergrad_diversity)
		),
		list(
			extend= "colvisGroup",
			text="Faculty counts & percentage",
			show=c(0, GetMatchingColumnsInOverview(Faculty_diversity)), 
			hide=GetNotMatchingColumnsInOverview(Faculty_diversity)
		),
		list(extend = 'colvis', columns = -1+sequence(ncol(overview))),
		list(extend= "colvisGroup",text="Show All",show=":hidden")


    ), # all 5 are hideable/showable by the button
	fixedColumns = list(leftColumns=1),
	pageLength = 100,
	fixedHeader = TRUE,
	escape = FALSE,
	columnDefs = list(
      list(targets = c(4:(ncol(overview)-1)), visible = FALSE)
    )
  )
) %>% formatPercentage(c("Yield", "Admission", "Graduation", "First year retention"), 0)

```